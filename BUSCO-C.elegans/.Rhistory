knitr::opts_chunk$set(echo = TRUE)
library(GenomicRanges)
library(data.table)
library(plyr)
library(dplyr)
library(seqinr)
calculateTotalCoverage <- function(coverage){
totalCoverage <- coverage[,3]
totalCoverage <- totalCoverage[(totalCoverage > 10 & totalCoverage<=200)]   #Limited the data so it is easier to see the main parts of it. We can also limit the data later on as well.
totalCoverage <- as.data.frame(totalCoverage)
return(totalCoverage)
}
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]
}
library(ggplot2)
PercentAAGreaterThan <- function(diamondGRanges,proteinFile){
coverage <- as.data.frame(coverage(diamondGRanges))
totalCoverage <- calculateTotalCoverage(coverage)
threholdCoverage <- getmode(totalCoverage[,1])
pertcentAAGreaterThanThreshold <-   coverage[,c(2,3)] %>%
group_by(group_name) %>%
filter(value >= threholdCoverage)%>%
tally()
pertcentAAGreaterThanThreshold$Length <- as.vector(seqlengths(diamondGRanges)[pertcentAAGreaterThanThreshold$group_name])
pertcentAAGreaterThanThreshold <- data.frame(mutate(pertcentAAGreaterThanThreshold,Percentcov=n/Length*100))
pertcentAAGreaterThanThreshold <- left_join(data.frame(group_name = names(read.fasta(proteinFile))),pertcentAAGreaterThanThreshold)
pertcentAAGreaterThanThreshold$Percentcov[is.na(pertcentAAGreaterThanThreshold$Percentcov)] = 0
return(pertcentAAGreaterThanThreshold)
}
getModeGranges <- function(diamondGRanges,proteinFile){
coverage <- as.data.frame(coverage(diamondGRanges))
totalCoverage <- calculateTotalCoverage(coverage)
threholdCoverage <- getmode(totalCoverage[,1])
return(threholdCoverage)
}
load("../app/LangCelegansBuscoGranges.Rdata")
LangeCelegans <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
LangeCelegansCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
load("../app/LangBuscoGranges.Rdata")
LangBusco <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoProteinSet.fa")
knitr::opts_chunk$set(echo = TRUE)
saveFiles <- function(x){
lapply(split(x,x$file),function(x){
print(paste0(seqnames(x)[1],".",x$file[1],".txt"))
write.table(sapply(strsplit(x$Query,".",TRUE), "[[", 2),paste0("readAllignments/",seqnames(x)[1],".",x$file[1],".txt"),quote=FALSE,row.names = FALSE,col.names = FALSE)
})
return("Passed")
}
load("../app/LangCelegansMMseqs2Granges.Rdata")
load("../app/LangCelegansMMseqs2Granges.Rdata")
splitDiamond <- split(diamondGRanges,seqnames(diamondGRanges))
splitDiamond <- split(diamondGRanges,seqnames(diamondGRanges))
lapply(splitDiamond[1:2],saveFiles)
lapply(splitDiamond,saveFiles)
knitr::opts_chunk$set(echo = TRUE)
library(GenomicRanges)
library(data.table)
library(plyr)
library(dplyr)
library(seqinr)
calculateTotalCoverage <- function(coverage){
totalCoverage <- coverage[,3]
totalCoverage <- totalCoverage[(totalCoverage > 10 & totalCoverage<=200)]   #Limited the data so it is easier to see the main parts of it. We can also limit the data later on as well.
totalCoverage <- as.data.frame(totalCoverage)
return(totalCoverage)
}
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]
}
library(ggplot2)
PercentAAGreaterThan <- function(diamondGRanges,proteinFile){
coverage <- as.data.frame(coverage(diamondGRanges))
totalCoverage <- calculateTotalCoverage(coverage)
threholdCoverage <- getmode(totalCoverage[,1])
pertcentAAGreaterThanThreshold <-   coverage[,c(2,3)] %>%
group_by(group_name) %>%
filter(value >= threholdCoverage)%>%
tally()
pertcentAAGreaterThanThreshold$Length <- as.vector(seqlengths(diamondGRanges)[pertcentAAGreaterThanThreshold$group_name])
pertcentAAGreaterThanThreshold <- data.frame(mutate(pertcentAAGreaterThanThreshold,Percentcov=n/Length*100))
pertcentAAGreaterThanThreshold <- left_join(data.frame(group_name = names(read.fasta(proteinFile))),pertcentAAGreaterThanThreshold)
pertcentAAGreaterThanThreshold$Percentcov[is.na(pertcentAAGreaterThanThreshold$Percentcov)] = 0
return(pertcentAAGreaterThanThreshold)
}
getModeGranges <- function(diamondGRanges,proteinFile){
coverage <- as.data.frame(coverage(diamondGRanges))
totalCoverage <- calculateTotalCoverage(coverage)
threholdCoverage <- getmode(totalCoverage[,1])
return(threholdCoverage)
}
load("../app/LangCelegansBuscoGranges.Rdata")
LangeCelegans <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
LangeCelegansCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
load("../app/LangBuscoGranges.Rdata")
LangBusco <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoProteinSet.fa")
LangBuscoCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoProteinSet.fa")
load("../app/SchwarzCelegansBuscoGranges.Rdata")
SchwarzeCelegans <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
SchwarzeCelegansCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
load("../app/SchwarzBuscoGranges.Rdata")
SchwarzBusco <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoProteinSet.fa")
SchwarzBuscoCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoProteinSet.fa")
load("../app/LangCelegansMoreSensativeBuscoGranges.Rdata")
LangeCelegansMoreSensative <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
LangeCelegansMoreSensativeCV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
load("../app/LangCelegansMMseqs2Granges.Rdata")
LangeCelegansMMseqs2 <- PercentAAGreaterThan(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
LangeCelegansMMseqs2CV <- getModeGranges(diamondGRanges,"../Similarity Analysis/BuscoCelegans.fasta")
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV))
ggsave("Lang1",device="jpeg")
ggsave("Lang1.jpeg",device="jpeg")
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV))
ggsave("Lang2.jpeg",device="jpeg")
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV))
ggsave("Lang3.jpeg",device="jpeg")
ggsave("Lang1.jpeg",device="jpeg", width = 12)
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV))
ggsave("Lang1.jpeg",device="jpeg", width = 10)
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV))
ggsave("Lang2.jpeg",device="jpeg", width = 10)
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV))
ggsave("Lang3.jpeg",device="jpeg", width = 10)
ggplot(LangeCelegansMMseqs2,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO Proteins using MMseqs2",subtitle = paste("CoverageThreshold =",LangeCelegansMMseqs2CV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMMseqs2CV))
ggsave("Lang4.jpeg",device="jpeg", width = 10)
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV))
ggsave("Lang1.png",device="png", width = 10, height = 7)
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV))
ggsave("Lang2.png",device="png", width = 10, height = 7)
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV))
ggsave("Lang3.png",device="png", width = 10, height = 7)
ggplot(LangeCelegansMMseqs2,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO Proteins using MMseqs2",subtitle = paste("CoverageThreshold =",LangeCelegansMMseqs2CV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMMseqs2CV))
ggsave("Lang4.png",device="png", width = 10, height = 7)
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV), y = "Count")
ggsave("Lang1.png",device="png", width = 10, height = 7)
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV), y = "Count")
ggsave("Lang2.png",device="png", width = 10, height = 7)
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV), y = "Count")
ggsave("Lang3.png",device="png", width = 10, height = 7)
ggplot(LangeCelegansMMseqs2,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO Proteins using MMseqs2",subtitle = paste("CoverageThreshold =",LangeCelegansMMseqs2CV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMMseqs2CV), y = "Count")
ggsave("Lang4.png",device="png", width = 10, height = 7)
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV), y = "Count")
ggsave("Lang1.png",device="png", width = 8, height = 7)
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV), y = "Count")
ggsave("Lang2.png",device="png", width = 8, height = 7)
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV), y = "Count")
ggsave("Lang3.png",device="png", width = 8, height = 7)
ggplot(LangeCelegansMMseqs2,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO Proteins using MMseqs2",subtitle = paste("CoverageThreshold =",LangeCelegansMMseqs2CV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMMseqs2CV), y = "Count")
ggsave("Lang4.png",device="png", width = 8, height = 7)
ggplot(LangeCelegans,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110)+labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND", subtitle = paste("CoverageThreshold =",LangeCelegansCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansCV), y = "Count")
ggsave("Lang1.png",device="png", width = 9, height = 7)
ggplot(LangBusco,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) +labs(title = "Laing sequencing reads aligned to BUSCO proteins using DIAMOND",subtitle = paste("CoverageThreshold =",LangBuscoCV), x = paste("Percent of amino acids with minimum depth >= ",LangBuscoCV), y = "Count")
ggsave("Lang2.png",device="png", width = 9, height = 7)
ggplot(LangeCelegansMoreSensative,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO proteins using DIAMOND More Sensitive",subtitle = paste("CoverageThreshold =",LangeCelegansMoreSensativeCV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMoreSensativeCV), y = "Count")
ggsave("Lang3.png",device="png", width = 9, height = 7)
ggplot(LangeCelegansMMseqs2,aes(Percentcov))+geom_histogram(binwidth = 5)+ylim(0,110) + labs(title = "Laing sequencing reads aligned to C.elegans BUSCO Proteins using MMseqs2",subtitle = paste("CoverageThreshold =",LangeCelegansMMseqs2CV), x = paste("Percent of amino acids with minimum depth >= ",LangeCelegansMMseqs2CV), y = "Count")
ggsave("Lang4.png",device="png", width = 9, height = 7)
